# **다 쓴 객체 참조를 해제하자**

## **1. 객체 참조 해제**

### **불필요한 참조 유지 문제**
- 다 쓴 객체를 계속 참조하면 **메모리 누수**가 발생할 수 있음.
- 가비지 컬렉터(GC)는 참조가 남아 있는 객체를 수거하지 않으므로 참조를 적절히 해제해야 함.

### **올바른 객체 참조 해제 방법**
1. **`null` 처리**:
    - 특정 상황에서만 사용.
    - **스택(Stack)처럼 메모리를 직접 관리하는 클래스**에서 원소를 다 사용한 즉시 참조를 해제.
     
2. **유효 스코프 밖으로 밀어내기**:
    - 참조 변수를 유효 스코프 밖으로 밀어내면 GC가 객체를 안전하게 수거 가능.
    - 가장 추천되는 방법.

---

## **2. 캐시와 메모리 누수**

### **캐시의 문제**
- 캐시는 메모리 누수의 주요 원인 중 하나.
- 객체가 더 이상 필요하지 않아도 캐시에 남아 GC가 수거하지 못하는 경우가 발생.

### **캐시 메모리 누수 해결 방법**
1. **`WeakHashMap` 활용**:
    - 키 값에 대한 참조가 끊기면 자동으로 GC에 의해 수거.
    - 예:
      ```java
      Map<Object, Object> cache = new WeakHashMap<>();
      cache.put(key, value); // 약한 참조를 기반으로 캐시 구성
      ```

2. **주기적인 청소 작업**:
    - 오래된 엔트리를 제거하거나 주기적으로 캐시를 청소.
    - **백그라운드 스레드 활용**:
        - `ScheduledThreadPoolExecutor`를 이용해 캐시를 주기적으로 정리.
    - **LRU(Least Recently Used) 정책**:
        - `LinkedHashMap`으로 캐시를 구성해 오래된 엔트리를 자동 제거.
          ```java
          Map<Object, Object> cache = new LinkedHashMap<>(16, 0.75f, true) {
              @Override
              protected boolean removeEldestEntry(Map.Entry<Object, Object> eldest) {
                  return size() > 100; // 캐시 크기 제한
              }
          };
          ```

---

## **3. 리스너와 콜백**

### **문제점**
- 리스너 또는 콜백을 등록하고 해제하지 않으면 참조가 계속 유지되어 누적.
- 콜백이 GC에 의해 수거되지 않으므로 메모리 누수가 발생.

### **해결 방법**
1. **약한 참조 사용**:
    - 콜백을 약한 참조로 저장하여 GC가 참조를 끊을 수 있도록 설정.
    - 예:
      ```java
      Map<Object, Runnable> listeners = new WeakHashMap<>();
      listeners.put(key, callback);
      ```
2. **명시적 해제**:
    - 더 이상 필요 없는 콜백은 명시적으로 제거.


## ** 리스너와 콜백의 특징**
| **특징**      | **리스너 (Listener)**              | **콜백 (Callback)**                  |
|---------------|------------------------------------|---------------------------------------|
| **목적**      | 이벤트를 감지하여 실행             | 작업 완료 후 실행                    |
| **동작 방식** | 이벤트 발생 시 실행                | 작업 완료 후 호출                    |
| **주 사용 사례** | UI 이벤트, 사용자 인터랙션         | 비동기 작업, 데이터베이스 작업, 파일 작업 등 |
| **등록 방식** | 리스너 객체를 등록                 | 콜백 함수를 메서드 인자로 전달        |
| **비동기성**  | 보통 동기적 (UI 이벤트 등)          | 비동기 작업에서 자주 사용             |



